version: "3.9"

services:
  # --- SERVICIOS EXISTENTES ---
  prd-web-static-datasyncsa-01:
    image: nginx:alpine
    container_name: prd-web-static-datasyncsa-01
    restart: unless-stopped
    ports:
      - "8081:80"
    volumes:
      - /srv/web/services/datasyncsa/www:/usr/share/nginx/html:ro
    networks:
      - web-internal

  prd-web-chat-client-01:
    image: nginx:alpine
    container_name: prd-web-chat-client-01
    restart: unless-stopped
    ports:
      - "8082:80"
    volumes:
      - /srv/web/services/chat-client/www:/usr/share/nginx/html:ro
      - /srv/web/services/chat-client/nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - web-internal

  prd-web-admin-nginx-01:
    image: nginx:alpine
    container_name: prd-web-admin-nginx-01
    restart: unless-stopped
    ports:
      - "8083:80"
    volumes:
      - /srv/web/services/admin-console/www:/var/www/public:ro
      - /srv/web/services/admin-console/nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - prd-web-admin-php-01
    networks:
      - web-internal

  prd-web-admin-php-01:
    build:
      context: ./admin-console/repo
      dockerfile: Dockerfile
    container_name: prd-web-admin-php-01
    restart: unless-stopped
    user: "${CURRENT_UID}:${CURRENT_GID}"
    volumes:
      - /srv/web/services/admin-console/repo:/var/www
      - /srv/web/services/admin-console/.env:/var/www/.env
    networks:
      - web-internal

  # --- NUEVOS SERVICIOS AIFIRST ---

  prd-web-aifirst-api-01:
    build:
      context: ./ai-first/backend
      dockerfile: Dockerfile
    container_name: prd-web-aifirst-api-01
    restart: unless-stopped
    user: "${CURRENT_UID}:${CURRENT_GID}"
    # AGREGAR ESTA L√çNEA:
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload 
    ports:
      - "8084:8000"
    volumes:
      - /srv/web/services/ai-first/backend:/app
    working_dir: /app
    env_file:
      - ./ai-first/.env
    networks:
      - web-internal

  prd-web-aifirst-static-01:
    image: nginx:alpine
    container_name: prd-web-aifirst-static-01
    restart: unless-stopped
    ports:
      - "8085:80"
    volumes:
      - /srv/web/services/ai-first/frontend:/usr/share/nginx/html:ro
    networks:
      - web-internal

networks:
  web-internal:
    driver: bridge